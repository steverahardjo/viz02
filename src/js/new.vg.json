{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "title": "Flow Map of Foreigners to Malaysia",
    "background": "#e0f7fa",
    "width": 600,
    "height": 600,
    "params": [
        {
          "name": "yearSelection",
          "value": "2020",
          "bind": {
            "input": "select",
            "options": ["2020", "2022", "2023", "2024"],
            "name": "Select Year: "
          }
        }
      ],
    "layer": [
      {
        "data": {
          "url": "https://cdn.jsdelivr.net/npm/vega-datasets@v1.29.0/data/world-110m.json",
          "format": {
            "type": "topojson",
            "feature": "countries"
          }
        },
        "projection": {
          "type": "mercator"
        },
        "mark": {
          "type": "geoshape",
          "stroke": "white",
          "fill": "#A88F59"
        }
      },
      {
        "data": {
          "url": "https://raw.githubusercontent.com/steverahardjo/viz02/refs/heads/main/src/dataset/grouped_arrivals.csv",
          "format": {
            "type": "csv"
          }
        },
        "transform": [
          {
            "calculate": "year(datum.date)",
            "as": "year"
          },
          {
            "filter": "yearSelection == datum.year"
          },
          {
            "lookup": "country",
            "from": {
              "data": {
                "url": "https://raw.githubusercontent.com/steverahardjo/viz02/refs/heads/main/src/dataset/grouped_arrivals.csv",
                "format": {
                  "type": "csv"
                }
              },
              "key": "country",
              "fields": ["longitude", "latitude"]
            },
            "as": ["origin_longitude", "origin_latitude"]
          },
          {
            "calculate": "101.9758", "as": "dest_longitude"
          },
          {
            "calculate": "4.2105", "as": "dest_latitude"
          }
        ],
        "mark": {
          "type": "rule",
          "color": "blueviolet"
        },
        "encoding": {
          "longitude": {
            "field": "origin_longitude",
            "type": "quantitative"
          },
          "latitude": {
            "field": "origin_latitude",
            "type": "quantitative"
          },
          "longitude2": {
            "field": "dest_longitude"
          },
          "latitude2": {
            "field": "dest_latitude"
          }
        }
      },
      {
        "data": {
          "url": "https://raw.githubusercontent.com/steverahardjo/viz02/refs/heads/main/src/dataset/grouped_arrivals.csv",
          "format": {
            "type": "csv"
          }
        },
        "transform": [
          {
            "calculate": "year(datum.date)",
            "as": "year"
          },
          {
            "filter": "yearSelection == datum.year"
          },
          {
            "aggregate": [
              {
                "op": "sum",
                "field": "arrivals",
                "as": "total_arrivals"
              }
            ],
            "groupby": ["country", "year"]
          },
          {
            "lookup": "country",
            "from": {
              "data": {
                "url": "https://raw.githubusercontent.com/steverahardjo/viz02/refs/heads/main/src/dataset/grouped_arrivals.csv",
                "format": {
                  "type": "csv"
                }
              },
              "key": "country",
              "fields": ["longitude", "latitude"]
            },
            "as": ["origin_longitude", "origin_latitude"]
          }
        ],
        "mark": {
          "type": "circle",
          "color": "orange",
          "opacity": 0.8
        },
        "encoding": {
          "longitude": {
            "field": "origin_longitude",
            "type": "quantitative"
          },
          "latitude": {
            "field": "origin_latitude",
            "type": "quantitative"
          },
          "size": {
            "field": "total_arrivals",
            "type": "quantitative",
            "scale": {
              "type": "sqrt",
              "range": [20, 800]
            }
          },
          "tooltip": [
            {
              "field": "country",
              "type": "nominal",
              "title": "Country"
            },
            {
              "field": "total_arrivals",
              "type": "quantitative",
              "title": "Arrivals",
              "format": ",.0f"
            }
          ]
        }
      }
    ]
  }
  